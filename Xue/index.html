<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="renderer" content="webkit">
    <title>Xue</title>

</head>
<body>

<p>{{name}}</p>
<p>{{age}}</p>



</body>

<script src="vue.min.js"></script>

<script>

    var sss = new Vue({
        el: 'body',
        methods: {
            fun: function () {
                alert('sss')
            }
        },
        ready: function () {
        }
    })
    function fun() {

    }
    console.log(sss, fun.prototype)



    function Xue (data) {
        this.$data
        this.$methods

        if (typeof data === 'object') {
            this.$data = data.data
            this.$methods = data.methods
            this._walk(this.$data, data.data)
            this._converseFun()

            data.ready.call(this);
        }

    }

    Xue.prototype = {
        constructor: Xue,

        _walk: function (scope, data) {
            var val
            for (var key in data) {
                if (data.hasOwnProperty(key)) {
                    val = data[key]
                    if (typeof val === 'object') {
                        this._walk(val, val)
                    }
                    this._watch(scope, key, val)
                }
            }
        },

        _watch: function (scope, key, val) {
            Object.defineProperty(scope, key, {
                enumerable: true,
                configurable: true,
                get: function () {
                    console.log('get ' + key, val)
                    return val
                },
                set: function (newVal) {
                    console.log('set ' + key, newVal, val)
                    if (val !== newVal) val = newVal
                }
            })
        },

        _converseFun: function () {
            var key, val, self = this;
            for (key in this.$methods) {
                val = this.$methods[key]
                if (typeof val === 'function') {
                    this.$methods[key] = function (i) {
                        var length = arguments.length;
                        length?
                                length > 1 ? val.apply(self, arguments) : val.call(self, i)
                                : val.call(self)
                    }
                }
            }
        }



    }


    var test = new Xue ({
        el: 'body',
        data: {
            name: 'Troy',
            age: '24'
        },
        methods: {
            addAttr: function (name) {
                console.log(name)
                this.$data.name = name;
            }
        },
        ready: function () {
            this.$methods.addAttr('Xiaoming')
        }

    })

    console.log(test)


</script>
</html>